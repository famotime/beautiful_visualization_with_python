<?xml version='1.0'?>
<opml version='2.0'>
  <head>
    <ownerEmail>
      quincy.zou@gmail.com
    </ownerEmail>
  </head>
  <body>
  <outline text="图8-3-3 簇状柱形图&#10;" _note="import pandas as pd&#10;import numpy as np&#10;from plotnine import *&#10;from plotnine.data import *&#10;import matplotlib.pyplot as plt&#10;&#10;&#10;categ_table = pd.DataFrame(&#10;    dict(names=['Peter', 'Jack', 'Eelin', 'John'], vals=[259, 83, 123, 162]))&#10;categ_table = categ_table.sort_values(by='vals', ascending=False)&#10;categ_table = categ_table.reset_index()&#10;N = len(categ_table)&#10;ndeep = 10&#10;Width = 2&#10;mydata = pd.DataFrame(columns=[&quot;x&quot;, &quot;y&quot;, &quot;names&quot;])&#10;&#10;for i in np.arange(0, N):&#10;    print(i)&#10;    x = categ_table['vals'][i]&#10;    a = np.arange(1, ndeep+1, 1)&#10;    b = np.arange(1, np.ceil(x/ndeep)+1, 1)&#10;    X, Y = np.meshgrid(a, b)&#10;    df_grid = pd.DataFrame({'x': X.flatten(), 'y': Y.flatten()})&#10;&#10;    category = np.repeat(categ_table['names'][i], x)&#10;&#10;    df_grid = df_grid.loc[np.arange(0, len(category)), :]&#10;    df_grid['x'] = df_grid['x']+i*ndeep+i*Width&#10;    df_grid['names'] = category&#10;    mydata = mydata.append(df_grid)&#10;&#10;mydata['names'] = pd.Categorical(mydata['names'], categories=categ_table['names'], ordered=True)&#10;mydata['x'] = mydata['x'].astype(float)&#10;x_breaks = (np.arange(0, N)+1)*ndeep+np.arange(0, N)*Width-ndeep/2&#10;x_label = categ_table.names&#10;&#10;mydata_label = pd.DataFrame(dict(y=np.ceil(&#10;    categ_table['vals']) / ndeep+2, x=x_breaks, label=categ_table['vals']))&#10;&#10;breaks = np.arange(0, 30, 10)&#10;mydata&#10;&#10;```&#10;```&#10;0&#10;1&#10;2&#10;3&#10;&#10;```&#10;&#10;```python&#10;base_plot = (ggplot() +&#10;             geom_tile(aes(x='x', y='y', fill='names'), mydata, color=&quot;black&quot;, size=0.25) +&#10;             geom_text(aes(x='x', y='y', label='label'), data=mydata_label, size=13) +&#10;             scale_fill_brewer(type='qual', palette=&quot;Set1&quot;) +&#10;             xlab(&quot;Name&quot;) +&#10;             ylab(&quot;Count: 1 row square =&quot; + str(ndeep)) +&#10;             scale_x_continuous(breaks=x_breaks, labels=x_label) +&#10;             scale_y_continuous(breaks=breaks, labels=breaks*ndeep, limits=(0, 30), expand=(0, 0)) +&#10;             theme_light() +&#10;             theme(&#10;    axis_title=element_text(size=15, face=&quot;plain&quot;, color=&quot;black&quot;),&#10;    axis_text=element_text(size=13, face=&quot;plain&quot;, color=&quot;black&quot;),&#10;    legend_position=&quot;none&quot;,&#10;    figure_size=(7, 7),&#10;    dpi=100))&#10;print(base_plot)&#10;&#10;```&#10;```&#10;&amp;lt;Figure size 700x700 with 1 Axes&amp;gt;&#10;```&#10;&#10;```python&#10;base_plot = (ggplot() +&#10;             # The color of the lines between tiles&#10;             geom_point(aes(x='x', y='y', fill='names'), mydata, shape='o', color=&quot;k&quot;, size=4, stroke=0.2) +&#10;             # The color of the lines between tiles&#10;             geom_text(aes(x='x', y='y', label='label'), data=mydata_label, size=13) +&#10;             scale_fill_brewer(type='qual', palette=&quot;Set1&quot;) +&#10;             xlab(&quot;Name&quot;) +&#10;             ylab(&quot;Count: 1 row square =&quot; + str(ndeep)) +&#10;             # coord_fixed(ratio = 1)+&#10;             scale_x_continuous(breaks=x_breaks, labels=x_label) +&#10;             scale_y_continuous(breaks=breaks, labels=breaks*ndeep, limits=(0, 30), expand=(0, 0)) +&#10;             theme_light() +&#10;             theme(  # panel.border = element_rect(fill=NA,size = 2),&#10;    axis_title=element_text(size=15, face=&quot;plain&quot;, color=&quot;black&quot;),&#10;    axis_text=element_text(size=13, face=&quot;plain&quot;, color=&quot;black&quot;),&#10;    legend_position=&quot;none&quot;,&#10;    # aspect_ratio =1,&#10;    figure_size=(7, 7),&#10;    dpi=100&#10;)&#10;)&#10;print(base_plot)&#10;&#10;```&#10;&#10;" />
  </outline>
  </body>
</opml>