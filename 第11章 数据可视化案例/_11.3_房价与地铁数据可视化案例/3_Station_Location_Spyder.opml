<?xml version='1.0'?>
<opml version='2.0'>
  <head>
    <ownerEmail>
      quincy.zou@gmail.com
    </ownerEmail>
  </head>
  <body>
  <outline text="3_Station_Location_Spyder&#10;" _note="from urllib.parse import quote&#10;from urllib import request&#10;import json&#10;import csv&#10;import time&#10;import re&#10;import pandas as pd&#10;&#10;&#10;# '3e65b5abc153f1aac68ec95b3a468e76'   # &#10;amap_web_key = 'bc76d5878a6a96afb43beab66126ecc7'&#10;poi_search_url = &quot;http://restapi.amap.com/v3/place/text&quot;&#10;poi_boundary_url = &quot;https://ditu.amap.com/detail/get/detail&quot;&#10;&#10;# 根据城市名称和分类关键字获取poi数据&#10;def getpois(cityname, keywords):&#10;    try:&#10;        result = getpoi_page(cityname, keywords, 1)&#10;        result = json.loads(result)  # 将字符串转换为json&#10;        pois = result['pois']&#10;        return pois[0]&#10;    except:&#10;        return '未获取经纬度'&#10;&#10;# 将返回的poi数据装入集合返回&#10;&#10;&#10;def hand(poilist, result):&#10;    # result = json.loads(result)  # 将字符串转换为json&#10;    pois = result['pois']&#10;    for i in range(len(pois)):&#10;        poilist.append(pois[i])&#10;&#10;# 单页获取pois&#10;&#10;&#10;def getpoi_page(cityname, keywords, page):&#10;    req_url = poi_search_url + &quot;?key=&quot; + amap_web_key + '&amp;extensions=all&amp;keywords=' + \&#10;        quote(keywords) + '&amp;city=' + quote(cityname) + '&amp;citylimit=true' + \&#10;        '&amp;offset=25' + '&amp;page=' + str(page) + '&amp;output=json'&#10;    data = ''&#10;    with request.urlopen(req_url) as f:&#10;        data = f.read()&#10;        data = data.decode('utf-8')&#10;    return data&#10;&#10;&#10;# 获取城市分类数据&#10;&#10;cityname = &quot;深圳&quot;&#10;Housename = &quot;罗湖地铁站&quot;&#10;pois = getpois(cityname, Housename)&#10;&#10;# # &#10;total = []&#10;Station_info = {}  # 新建一个字典用于存放单个房屋的信息&#10;Station_info['Station_Title'] = 'Station_Title'&#10;Station_info['Subway_Num2'] = 'Subway_Num2'&#10;Station_info['Station2'] = 'Station2'&#10;Station_info['longitude'] = 'longitude'&#10;Station_info['latitude'] = 'latitude'&#10;total.append(Station_info)&#10;i = 0&#10;with open('ShenzhenSubway_Station_WithXY.csv') as f:&#10;    f_csv = csv.DictReader(f)&#10;    for row in f_csv:&#10;        i = i+1&#10;        if (i &amp;lt; 1000):&#10;            pois = getpois(cityname, row['Station'])&#10;            if (pois == '未获取经纬度'):&#10;                continue&#10;            Station_info = {}  # 新建一个字典用于存放单个房屋的信息&#10;            Station_info['Station_Title'] = row['Station_Title']&#10;            Station_info['Station2'] = pois['name']&#10;            Station_info['Subway_Num2'] = pois['address']&#10;            Station_info['latitude'] = pois['location'].split(&quot;,&quot;)[0]&#10;            Station_info['longitude'] = pois['location'].split(&quot;,&quot;)[1]&#10;            total.append(Station_info)&#10;&#10;my_df_Location = pd.DataFrame(total)&#10;file = open('ShenzhenSubway_Station_WithXY.csv')&#10;my_df_XY = pd.read_csv(file)&#10;my_df = pd.merge(my_df_Location, my_df_XY, on='Station_Title')&#10;# my_df.to_csv('ShenzhenSubway_Station_WithLocation.csv', index=False, header=False)&#10;&#10;my_df&#10;```&#10;&#10;" />
  </outline>
  </body>
</opml>