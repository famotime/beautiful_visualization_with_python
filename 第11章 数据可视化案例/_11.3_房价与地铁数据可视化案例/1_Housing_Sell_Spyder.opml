<?xml version='1.0'?>
<opml version='2.0'>
  <head>
    <ownerEmail>
      quincy.zou@gmail.com
    </ownerEmail>
  </head>
  <body>
  <outline text="1_Housing_Sell_Spyder&#10;" _note="# https://www.jianshu.com/p/ecf3a88d9ae1&#10;# https://zhuanlan.zhihu.com/p/28059182&#10;import urllib.request&#10;from lxml import etree&#10;import pandas as pd&#10;# from openpyxl import Workbook&#10;&#10;&#10;# 获取并解码网页&#10;def get_htmltext(url):&#10;    html = urllib.request.urlopen(url)&#10;    htmltext = html.read().decode('utf-8')&#10;    return htmltext&#10;&#10;&#10;def get_data(htmltext, total):&#10;    html = etree.HTML(htmltext)  # 使用lxml库将获取的网页内容解析&#10;    # 将包含所有房屋的代码块提取出来，每个房屋的信息都是在&amp;lt;li class=&quot;clear&quot;&amp;gt;这个标签下面&#10;    houses = html.xpath('//ul[@class=&quot;sellListContent&quot;]/li')&#10;    # /html/body/div[4]/div[1]/ul/li[1]&#10;    # body &amp;gt; div.content &amp;gt; div.leftContent &amp;gt; ul &amp;gt; li:nth-child(1)&#10;    for house in houses:  # 迭代，将每个房屋各方面的信息提取出来&#10;        house_info = {}  # 新建一个字典用于存放单个房屋的信息&#10;        try:  # 抽取各个方面信息# &#10;            house_info['title'] = house.xpath('.//div[1]/div[1]/a/text()')[0]&#10;            house_info['addressinfo'] = house.xpath(&#10;                './/div[1]/div[2]/div/a/text()')[0]&#10;            # /html/body/div[4]/div[1]/ul/li[1]/div[1]/div[2]/div/a&#10;            house_info['sizeinfo'] = house.xpath(&#10;                './/div[1]/div[2]/div/text()')[0]&#10;            # /html/body/div[4]/div[1]/ul/li[1]/div[1]/div[2]/div/text()&#10;            # house_info['flood']=house.xpath('./div[@class=&quot;info clear&quot;]/div[@class=&quot;flood&quot;]/div/text()')[0]&#10;&#10;            house_info['followinfo'] = house.xpath(&#10;                './/div[1]/div[3]/div/text()')[0]&#10;            # /html/body/div[4]/div[1]/ul/li[1]/div[1]/div[3]/div&#10;            house_info['total_price'] = house.xpath(&#10;                './/div[1]/div[6]/div[1]/span/text()')[0]&#10;            # /html/body/div[4]/div[1]/ul/li[1]/div[1]/div[6]/div[1]/span&#10;            house_info['unit_price'] = house.xpath(&#10;                './/div[1]/div[6]/div[2]/span/text()')[0]&#10;            # /html/body/div[4]/div[1]/ul/li[1]/div[1]/div[6]/div[2]/span&#10;            total.append(house_info)  # 将单个房屋的信息放入总列表中&#10;        except:  # try，避免某方面信息缺失导致报错&#10;            continue&#10;    print('正在爬取第%d页' % i)&#10;&#10;# 下面这块代码是用来将解析后的网页内容导出保存，方便查找信息所在的路径&#10;# string=etree.tostring(html, encoding='utf-8', pretty_print=True, method='html')&#10;# handle=open(r'E:\test1\text.txt','w',encoding='utf-8')&#10;# handle.write(string.decode('utf-8'))&#10;&#10;&#10;# 运行起来&#10;total = []&#10;house_info = {}  # 新建一个字典用于存放单个房屋的信息&#10;house_info['title'] = 'title'&#10;house_info['addressinfo'] = 'addressinfo'&#10;house_info['sizeinfo'] = 'sizeinfo'&#10;# house_info['flood']='flood'&#10;house_info['followinfo'] = 'followinfo'&#10;house_info['total_price'] = 'total_price'&#10;house_info['unit_price'] = 'unit_price'&#10;total.append(house_info)&#10;for i in range(0, 1):&#10;    # https://cd.lianjia.com/ershoufang/pg%d/&#10;    url = 'https://sz.lianjia.com/ershoufang/pg%d/' % i&#10;    htmltext = get_htmltext(url)&#10;    get_data(htmltext, total)&#10;&#10;# 将结果放进空的DataFrame里面，方便使用pandas库对内容汇总处理。&#10;# df=pd.DataFrame(total)&#10;&#10;my_df = pd.DataFrame(total)&#10;my_df.to_csv('ShenzhenHousing_Price.csv', index=False, header=False)&#10;&#10;my_df&#10;```&#10;&#10;```python&#10;&#10;```&#10;&#10;" />
  </outline>
  </body>
</opml>