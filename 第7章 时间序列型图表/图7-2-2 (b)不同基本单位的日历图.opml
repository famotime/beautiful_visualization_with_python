<?xml version='1.0'?>
<opml version='2.0'>
  <head>
    <ownerEmail>
      quincy.zou@gmail.com
    </ownerEmail>
  </head>
  <body>
  <outline text="图7-2-2 (b)不同基本单位的日历图&#10;" _note="import pandas as pd&#10;import numpy as np&#10;from plotnine import *&#10;import matplotlib.pyplot as plt&#10;from datetime import datetime&#10;&#10;&#10;df = pd.read_csv('Calendar.csv', parse_dates=['date'])&#10;df['year'] = [d.year for d in df['date']]&#10;df = df[df['year'] == 2017]&#10;&#10;df['month'] = [d.month for d in df['date']]&#10;month_label = [&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;,&#10;               &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;]&#10;df['monthf'] = df['month'].replace(np.arange(1, 13, 1), month_label)&#10;df['monthf'] = pd.Categorical(df['monthf'], categories=month_label, ordered=True)&#10;&#10;df['week'] = [int(d.strftime('%W')) for d in df['date']]&#10;df['weekay'] = [int(d.strftime('%u')) for d in df['date']]&#10;&#10;week_label = [&quot;Mon&quot;, &quot;Tue&quot;, &quot;Wed&quot;, &quot;Thu&quot;, &quot;Fri&quot;, &quot;Sat&quot;, &quot;Sun&quot;]&#10;df['weekdayf'] = df['weekay'].replace(np.arange(1, 8, 1), week_label)&#10;df['weekdayf'] = pd.Categorical(df['weekdayf'], categories=week_label, ordered=True)&#10;&#10;df['day'] = [d.strftime('%d') for d in df['date']]&#10;&#10;df['monthweek'] = df.groupby('monthf')['week'].apply(lambda x: x-x.min()+1)&#10;df&#10;&#10;```&#10;```&#10;           date     value  year  month monthf  week  weekay weekdayf day  \&#10;1096 2017-01-01  4.884598  2017      1    Jan     0       7      Sun  01   &#10;1097 2017-01-02  4.424952  2017      1    Jan     1       1      Mon  02   &#10;1098 2017-01-03  4.267219  2017      1    Jan     1       2      Tue  03   &#10;1099 2017-01-04  3.933804  2017      1    Jan     1       3      Wed  04   &#10;1100 2017-01-05  3.610845  2017      1    Jan     1       4      Thu  05   &#10;...         ...       ...   ...    ...    ...   ...     ...      ...  ..   &#10;1456 2017-12-27  4.073826  2017     12    Dec    52       3      Wed  27   &#10;1457 2017-12-28  3.643086  2017     12    Dec    52       4      Thu  28   &#10;1458 2017-12-29  3.810235  2017     12    Dec    52       5      Fri  29   &#10;1459 2017-12-30  4.414853  2017     12    Dec    52       6      Sat  30   &#10;1460 2017-12-31  5.041024  2017     12    Dec    52       7      Sun  31   &#10;&#10;      monthweek  &#10;1096          1  &#10;1097          2  &#10;1098          2  &#10;1099          2  &#10;1100          2  &#10;...         ...  &#10;1456          5  &#10;1457          5  &#10;1458          5  &#10;1459          5  &#10;1460          5  &#10;&#10;[365 rows x 10 columns]&#10;```&#10;&#10;```python&#10;base_plot = (ggplot(df, aes('weekdayf', 'monthweek', fill='value')) +&#10;             geom_tile(colour=&quot;white&quot;, size=0.1) +&#10;             scale_fill_cmap(name='Spectral_r') +&#10;             geom_text(aes(label='day'), size=8) +&#10;             facet_wrap('~monthf', nrow=3) +&#10;             scale_y_reverse() +&#10;             xlab(&quot;Day&quot;) + ylab(&quot;Week of the month&quot;) +&#10;             theme(strip_text=element_text(size=11, face=&quot;plain&quot;, color=&quot;black&quot;),&#10;                   axis_title=element_text(&#10;                       size=10, face=&quot;plain&quot;, color=&quot;black&quot;),&#10;                   axis_text=element_text(size=8, face=&quot;plain&quot;, color=&quot;black&quot;),&#10;                   legend_position='right',&#10;                   legend_background=element_blank(),&#10;                   aspect_ratio=0.85,&#10;                   figure_size=(8, 8),&#10;                   dpi=100&#10;                   ))&#10;&#10;print(base_plot)&#10;&#10;```&#10;```&#10;&amp;lt;Figure size 800x573.631 with 12 Axes&amp;gt;&#10;```&#10;&#10;" />
  </outline>
  </body>
</opml>